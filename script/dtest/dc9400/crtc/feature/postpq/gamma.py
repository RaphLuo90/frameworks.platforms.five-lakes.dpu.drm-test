#############################################################################
#    Copyright 2012 - 2023 Vivante Corporation, Santa Clara, California.    #
#    All Rights Reserved.                                                   #
#                                                                           #
#    Permission is hereby granted, free of charge, to any person obtaining  #
#    a copy of this software and associated documentation files (the        #
#    'Software'), to deal in the Software without restriction, including    #
#    without limitation the rights to use, copy, modify, merge, publish,    #
#    distribute, sub license, and/or sell copies of the Software, and to    #
#    permit persons to whom the Software is furnished to do so, subject     #
#    to the following conditions:                                           #
#                                                                           #
#    The above copyright notice and this permission notice (including the   #
#    next paragraph) shall be included in all copies or substantial         #
#    portions of the Software.                                              #
#                                                                           #
#    THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,        #
#    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF     #
#    MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT.#
#    IN NO EVENT SHALL VIVANTE AND/OR ITS SUPPLIERS BE LIABLE FOR ANY       #
#    CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,   #
#    TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE      #
#    SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.                 #
#                                                                           #
#############################################################################

from collections import OrderedDict
from dtest.helper import *

def __get_name(id, subname, con_id=0):
    if con_id !=0:
        return 'crtc%d.feature.postpq.'%id + subname + '.connector%d'%con_id
    else:
        return 'crtc%d.feature.postpq.'%id + subname

def __get_property(prop_name):
    p = OrderedDict()
    p["in_bit"] = 14
    p["out_bit"] = 14
    p["seg_point"] = [ 2, 4, 16, 128, 256, 512, 2048 ]
    p["seg_step"] = [ 1, 2, 4, 8, 16, 8, 128, 256 ]
    return OrderedDict([(prop_name, p)])

def __get_roi_property(prop_name):
    p = OrderedDict()
    p["in_bit"] = 14
    p["out_bit"] = 14
    p["x"] = 200
    p["y"] = 200
    p["width"] = 200
    p["height"] = 200
    p["seg_point"] = [ 2, 4, 16, 128, 256, 512, 2048 ]
    p["seg_step"] = [ 1, 2, 4, 8, 16, 8, 128, 256 ]

    p1 = OrderedDict()
    p1["x"] = 0
    p1["y"] = 0
    p1["width"] = 320
    p1["height"] = 240
    p1["red_channel"] = [0,88,177,266,354,443,532,620,709,674,763,851,940,1029,1117,1206,1295,1383,1348,1437,1526,1614,1703,1792,1880,1969,2058,2023,2111,2200,2289,2377,2466,2555,2643,2732,2697,2786,2874,2963,3052,3140,3229,3318,3406,3371,3460,3549,3637,3726,3815,3903,3992,4081,4046,4134,4223,4312,4400,4489,4578,4666,4755,4720,4809,4897,4986,5075,5163,5252,5341,5429,5394,5483,5572,5660,5749,5838,5926,6015,6104,1284,1373,1462,1550,1639,1728,1816,1905,1994,1959,2047,2136,2225,2313,2402,2491,2579,2668,2633,2722,2810,2899,2988,3076,3165,3254,3342,3307,3396,3485,3573,3662,3751,3839,3928,4017,3982,4070,4159,4248,4336,4425,4514,4603,4691,4656,4745,4834,4922,5011,5100,5188,5277,5366,5331,5419,5508,5597,5685,5774,5863,5951,6040,6005,6094,6182,6271,6360,6448,6537,6626,6714,6679,6768,6857,6945,7034,7123,7211,7300,7389,2569,2658,2747,2835,2924,3013,3101,3190,3279,3244,3332,3421,3510,3598,3687,3776,3864,3953,3918,4007,4095,4184,4273,4361,4450,4539,4627,4592,4681,4770,4858,4947,5036,5124,5213,5302,5267,5355,5444,5533,5621,5710,5799,5887,5976,5941,6030,6118,6207,6296,6384,6473,6562,6650,6615,6704,6793,6881,6970,7059,7147,7236,7325,7290,7378,7467,7556,7644,7733,7822,7910,7999,7964,8053,8141,8230,8319,8407,8496,8585,8673,3854,3943,4031,4120,4209,4297,4386,4475,4563,4528,4617,4706,4794,4883,4972,5060,5149,5238,5203,5291,5380,5469,5557,5646,5735,5823,5912,5877,5966,6054,6143,6232,6320,6409,6498,6586,6551,6640,6729,6817,6906,6995,7084,7172,7261,7226,7315,7403,
                    7492,7581,7669,7758,7847,7935,7900,7989,8078,8166,8255,8344,8432,8521,8610,8575,8663,8752,8841,8929,9018,9107,9195,9284,9249,9338,9426,9515,9604,9692,9781,9870,9958,5139,5228,5316,5405,5494,5582,5671,5760,5848,5813,5902,5991,6079,6168,6257,6345,6434,6523,6488,6576,6665,6754,6842,6931,7020,7108,7197,7162,7251,7339,7428,7517,7605,7694,7783,7871,7836,7925,8014,8102,8191,8280,8368,8457,8546,8511,8599,8688,8777,8865,8954,9043,9131,9220,9185,9274,9362,9451,9540,9628,9717,9806,9894,9859,9948,10037,10125,10214,10303,10391,10480,10569,10534,10622,10711,10800,10888,10977,11066,11154,11243,6424,6512,6601,6690,6778,6867,6956,7044,7133,7098,7187,7275,7364,7453,7541,7630,7719,7807,7772,7861,7950,8038,8127,8216,8304,8393,8482,8447,8535,8624,8713,8801,8890,8979,9067,9156,9121,9210,9298,9387,9476,9565,9653,9742,9831,9796,9884,9973,10062,10150,10239,10328,10416,10505,10470,10559,10647,10736,10825,10913,11002,11091,11179,11144,11233,11322,11410,11499,11588,11676,11765,11854,11819,11907,11996,12085,12173,12262,12351,12439,12528,7709,7797,7886,7975,8063,8152,8241,8329,8418,8383,8472,8560,8649,8738,8826,8915,9004,9092,9057,9146,9235,9323,9412,9501,9589,9678,9767,9732,9820,9909,9998,10086,10175,10264,10352,10441,10406,10495,10583,10672,10761,10849,10938,11027,11115,11080,11169,11258,11346,11435,11524,11612,11701,11790,11755,11843,11932,12021,12109,12198,12287,12375,12464,12429,12518,12606,12695,12784,12872,12961,13050,13138,13103,13192,
                    13281,13369,13458,13547,13635,13724,13813,8993,9082,9171,9259,9348,9437,9525,9614,9703,9668,9756,9845,9934,10022,10111,10200,10288,10377,10342,10431,10519,10608,10697,10785,10874,10963,11051,11016,11105,11194,11282,11371,11460,11548,11637,11726,11691,11779,11868,11957,12046,12134,12223,12312,12400,12365,12454,12543,12631,12720,12809,12897,12986,13075,13040,13128,13217,13306,13394,13483,13572,13660,13749,13714,13803,13891,13980,14069,14157,14246,14335,14423,14388,14477,14566,14654,14743,14832,14920,15009,15098,10278,10367,10456,10544,10633,10722,10810,10899,10988,10953,11041,11130,11219,11307,11396,11485,11573,11662,11627,11716,11804,11893,11982,12070,12159,12248,12336,12301,12390,12479,12567,12656,12745,12833,12922,13011,12976,13064,13153,13242,13330,13419,13508,13596,13685,13650,13739,13827,13916,14005,14093,14182,14271,14359,14324,14413,14502,14590,14679,14768,14856,14945,15034,14999,15087,15176,15265,15353,15442,15531,15619,15708,15673,15762,15850,15939,16028,16116,16205,16294,16382]
    p1["green_channel"] = [0,23,46,70,93,116,140,163,186,1883,1906,1929,1953,1976,1999,2023,2046,2069,3766,3789,3812,3836,3859,3882,3906,3929,3952,5649,5672,5695,5719,5742,5765,5789,5812,5835,7532,7555,7578,7602,7625,7648,7672,7695,7718,9415,9438,9461,9485,9508,9531,9555,9578,9601,11298,11321,11344,11368,11391,11414,11438,11461,11484,13181,13204,13227,13251,13274,13297,13321,13344,13367,15064,15087,15110,15134,15157,15180,15204,15227,15250,141,164,188,211,234,258,281,304,328,2024,2047,2071,2094,2117,2141,2164,2187,2211,3907,3930,3954,3977,4000,4024,4047,4070,4094,5790,5813,5837,5860,5883,5907,5930,5953,5977,7673,7696,7720,7743,7766,7790,7813,7837,7860,9556,9579,9603,9626,9649,9673,9696,9720,9743,11439,11462,11486,11509,11533,11556,11579,11603,11626,13322,13346,13369,13392,13416,13439,13462,13486,13509,15205,15229,15252,15275,15299,15322,15345,15369,15392,283,306,329,353,376,399,423,446,469,2166,2189,2212,2236,2259,2282,2306,2329,2352,4049,4072,4095,4119,4142,4165,4189,4212,4235,5932,5955,5978,6002,6025,6048,6072,6095,6118,7815,7838,7861,7885,7908,7931,7955,7978,8001,9698,9721,9744,9768,9791,9814,9838,9861,9884,11581,11604,11627,11651,11674,11697,11721,11744,11767,13464,13487,13510,13534,13557,13580,13604,13627,13650,15347,15370,15393,15417,15440,15463,15487,15510,15533,424,447,471,494,517,541,564,587,611,2307,2330,2354,2377,2400,2424,2447,2470,2494,4190,4213,4237,4260,4283,4307,4330,4353,4377,6073,6096,6120,6143,6166,6190,6213,6237,6260,7956,7979,
                    8003,8026,8049,8073,8096,8120,8143,9839,9862,9886,9909,9933,9956,9979,10003,10026,11722,11745,11769,11792,11816,11839,11862,11886,11909,13605,13629,13652,13675,13699,13722,13745,13769,13792,15488,15512,15535,15558,15582,15605,15628,15652,15675,566,589,612,636,659,682,706,729,752,2449,2472,2495,2519,2542,2565,2589,2612,2635,4332,4355,4378,4402,4425,4448,4472,4495,4518,6215,6238,6261,6285,6308,6331,6355,6378,6401,8098,8121,8144,8168,8191,8214,8238,8261,8284,9981,10004,10027,10051,10074,10097,10121,10144,10167,11864,11887,11910,11934,11957,11980,12004,12027,12050,13747,13770,13793,13817,13840,13863,13887,13910,13933,15630,15653,15676,15700,15723,15746,15770,15793,15816,707,730,754,777,800,824,847,870,894,2590,2613,2637,2660,2683,2707,2730,2753,2777,4473,4496,4520,4543,4566,4590,4613,4637,4660,6356,6379,6403,6426,6449,6473,6496,6520,6543,8239,8262,8286,8309,8333,8356,8379,8403,8426,10122,10145,10169,10192,10216,10239,10262,10286,10309,12005,12029,12052,12075,12099,12122,12145,12169,12192,13888,13912,13935,13958,13982,14005,14028,14052,14075,15771,15795,15818,15841,15865,15888,15911,15935,15958,849,872,895,919,942,965,989,1012,1035,2732,2755,2778,2802,2825,2848,2872,2895,2918,4615,4638,4661,4685,4708,4731,4755,4778,4801,6498,6521,6544,6568,6591,6614,6638,6661,6684,8381,8404,8427,8451,8474,8497,8521,8544,8567,10264,10287,10310,10334,10357,10380,10404,10427,10450,12147,12170,12193,12217,12240,12263,12287,12310,12333,14030,
                    14053,14076,14100,14123,14146,14170,14193,14216,15913,15936,15959,15983,16006,16029,16053,16076,16099,990,1013,1037,1060,1083,1107,1130,1153,1177,2873,2896,2920,2943,2966,2990,3013,3036,3060,4756,4779,4803,4826,4849,4873,4896,4920,4943,6639,6662,6686,6709,6733,6756,6779,6803,6826,8522,8545,8569,8592,8616,8639,8662,8686,8709,10405,10429,10452,10475,10499,10522,10545,10569,10592,12288,12312,12335,12358,12382,12405,12428,12452,12475,14171,14195,14218,14241,14265,14288,14311,14335,14358,16054,16078,16101,16124,16148,16171,16194,16218,16241,1132,1155,1178,1202,1225,1248,1272,1295,1318,3015,3038,3061,3085,3108,3131,3155,3178,3201,4898,4921,4944,4968,4991,5014,5038,5061,5084,6781,6804,6827,6851,6874,6897,6921,6944,6967,8664,8687,8710,8734,8757,8780,8804,8827,8850,10547,10570,10593,10617,10640,10663,10687,10710,10733,12430,12453,12476,12500,12523,12546,12570,12593,12616,14313,14336,14359,14383,14406,14429,14453,14476,14499,16196,16219,16242,16266,16289,16312,16336,16359,16383]
    p1["blue_channel"] = [0,1834,3668,5502,7336,9170,11004,12838,14672,180,2014,3848,5682,7516,9350,11184,13018,14852,360,2194,4028,5862,7696,9530,11364,13198,15033,540,2374,4208,6042,7876,9711,11545,13379,15213,720,2554,4389,6223,8057,9891,11725,13559,15393,901,2735,4569,6403,8237,10071,11905,13739,15573,1081,2915,4749,6583,8417,10251,12085,13919,15753,1261,3095,4929,6763,8597,10431,12265,14100,15934,1441,3275,5109,6943,8778,10612,12446,14280,16114,33,1867,3701,5535,7369,9203,11038,12872,14706,213,2047,3881,5716,7550,9384,11218,13052,14886,394,2228,4062,5896,7730,9564,11398,13232,15066,574,2408,4242,6076,7910,9744,11578,13412,15246,754,2588,4422,6256,8090,9924,11758,13592,15427,934,2768,4602,6436,8270,10105,11939,13773,15607,1114,2948,4783,6617,8451,10285,12119,13953,15787,1295,3129,4963,6797,8631,10465,12299,14133,15967,1475,3309,5143,6977,8811,10645,12479,14313,16147,67,1901,3735,5569,7403,9237,11071,12905,14739,247,2081,3915,5749,7583,9417,11251,13085,14919,427,2261,4095,5929,7763,9597,11432,13266,15100,607,2441,4275,6110,7944,9778,11612,13446,15280,788,2622,4456,6290,8124,9958,11792,13626,15460,968,2802,4636,6470,8304,10138,11972,13806,15640,1148,2982,4816,6650,8484,10318,12152,13986,15821,1328,3162,4996,6830,8664,10499,12333,14167,16001,1508,3342,5177,7011,8845,10679,12513,14347,16181,100,1934,3768,5602,7437,9271,11105,12939,14773,280,2115,3949,5783,7617,9451,11285,13119,14953,461,2295,4129,5963,7797,9631,11465,13299,15133,641,2475,4309,6143,7977,9811,11645,
                    13479,15314,821,2655,4489,6323,8157,9991,11826,13660,15494,1001,2835,4669,6504,8338,10172,12006,13840,15674,1182,3016,4850,6684,8518,10352,12186,14020,15854,1362,3196,5030,6864,8698,10532,12366,14200,16034,1542,3376,5210,7044,8878,10712,12546,14380,16215,134,1968,3802,5636,7470,9304,11138,12972,14806,314,2148,3982,5816,7650,9484,11319,13153,14987,494,2328,4162,5996,7831,9665,11499,13333,15167,674,2509,4343,6177,8011,9845,11679,13513,15347,855,2689,4523,6357,8191,10025,11859,13693,15527,1035,2869,4703,6537,8371,10205,12039,13873,15708,1215,3049,4883,6717,8551,10386,12220,14054,15888,1395,3229,5063,6898,8732,10566,12400,14234,16068,1576,3410,5244,7078,8912,10746,12580,14414,16248,167,2002,3836,5670,7504,9338,11172,13006,14840,348,2182,4016,5850,7684,9518,11352,13186,15020,528,2362,4196,6030,7864,9698,11532,13366,15200,708,2542,4376,6210,8044,9878,11713,13547,15381,888,2722,4556,6391,8225,10059,11893,13727,15561,1068,2903,4737,6571,8405,10239,12073,13907,15741,1249,3083,4917,6751,8585,10419,12253,14087,15921,1429,3263,5097,6931,8765,10599,12433,14267,16102,1609,3443,5277,7111,8945,10780,12614,14448,16282,201,2035,3869,5703,7537,9371,11205,13040,14874,381,2215,4049,5883,7718,9552,11386,13220,15054,561,2396,4230,6064,7898,9732,11566,13400,15234,742,2576,4410,6244,8078,9912,11746,13580,15414,922,2756,4590,6424,8258,10092,11926,13760,15594,1102,2936,4770,6604,8438,10272,12107,13941,15775,1282,3116,4950,6785,8619,10453,12287,14121,15955,1463,
                    3297,5131,6965,8799,10633,12467,14301,16135,1643,3477,5311,7145,8979,10813,12647,14481,16315,235,2069,3903,5737,7571,9405,11239,13073,14907,415,2249,4083,5917,7751,9585,11419,13253,15087,595,2429,4263,6097,7931,9765,11599,13434,15268,775,2609,4443,6277,8112,9946,11780,13614,15448,955,2790,4624,6458,8292,10126,11960,13794,15628,1136,2970,4804,6638,8472,10306,12140,13974,15808,1316,3150,4984,6818,8652,10486,12320,14154,15988,1496,3330,5164,6998,8832,10666,12501,14335,16169,1676,3510,5344,7179,9013,10847,12681,14515,16349,268,2102,3936,5770,7604,9439,11273,13107,14941,448,2282,4117,5951,7785,9619,11453,13287,15121,629,2463,4297,6131,7965,9799,11633,13467,15301,809,2643,4477,6311,8145,9979,11813,13647,15481,989,2823,4657,6491,8325,10159,11993,13828,15662,1169,3003,4837,6671,8506,10340,12174,14008,15842,1349,3184,5018,6852,8686,10520,12354,14188,16022,1530,3364,5198,7032,8866,10700,12534,14368,16202,1710,3544,5378,7212,9046,10880,12714,14548,16383]
    return OrderedDict([(prop_name, p), ('ROI0_3DLUT', p1)])

def __get_golden():
    # Fill golden
    #return OrderedDict([('md5sum', '1234567')])
    return OrderedDict()

def __get_case(id, name, prop_name, con_id = 0):
    if prop_name == 'ROI0_GAMMA' :
        crtc = Crtc(id, __get_roi_property(prop_name))
    else:
        crtc = Crtc(id, __get_property(prop_name))
    plane = Plane(0, crtc, 'AR24', 640, 480, 60)
    conn = Connector(con_id, crtc, 'AR30', 640, 480, 60, golden=__get_golden())
    return DTestUnit(plane, conn, __get_name(id, name, con_id))

@dtest_unit_group('dc9400')
def __gen(chip_info):
    name = 'prior_gamma'
    prop_name = 'PRIOR_GAMMA'
    return [ __get_case(0, name, prop_name), __get_case(1, name, prop_name), __get_case(1, name, prop_name, 1) ]

@dtest_unit_group('dc9400')
def __gen(chip_info):
    name = 'roi0_gamma'
    prop_name = 'ROI0_GAMMA'
    return [ __get_case(0, name, prop_name) ]
